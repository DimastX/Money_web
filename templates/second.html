<!DOCTYPE html>
<html>
<head>
    <title>Second Page</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/tables.css') }}" rel="stylesheet" type="text/css" >
    <link href="{{ url_for('static', filename='css/button.css') }}" rel="stylesheet" type="text/css" >
    <link href="{{ url_for('static', filename='css/doubletitle.css') }}" rel="stylesheet" type="text/css" >
</head>
<body>
        <!-- вывод flash-сообщений -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="alert">
            <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
            {% for message in messages %}
                {{ message }}
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}
    <div class="container">
        <form method="POST">
            <br>
            <button type="submit" class="btn btn-primary" name="back">Назад</button>
            <button type="submit" class="btn btn-primary" name="tariffs">Тарифы</button>
            <button type="submit" class="btn btn-primary" name="next">Вперёд</button>
            <p></p>
            <table>
                <tr>
                    <td>
                        <div class="form-group">
                            <label>Комплектация:</label>
                            <br>
                            <label>
                                <input type="radio" name="Comp" value="1" title="+10% к входному контролю, +15% к входному контролю"
                                       {% if session.get('second_form')%} {% if session['second_form']['Comp'] == "1" %} checked {% endif %} {% endif %}>
                                Давальческая (россыпью)
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="Comp" title="+10% к входному контролю"
                                       {% if session.get('second_form')%} {% if session['second_form']['Comp'] == "2" %} checked {% endif %} {% endif %} value="2">
                                Разрабатывает (в заводской упаковке)
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="Comp" title="Надбавочного коэффициента нет"
                                       {% if session.get('second_form')%} {% if session['second_form']['Comp'] == "3" %} checked {% endif %} {% endif %} value="3">
                                Закупка Starline
                            </label>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label>Мультизаготовка:</label>
                            <br>
                            <label>
                                <input type="radio" name="multi" value="1"
                                       {% if session.get('second_form')%} {% if session['second_form']['multi'] == "1" %} checked {% endif %} {% endif %}>
                                Давальческая
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="multi"
                                       {% if session.get('second_form')%} {% if session['second_form']['multi'] == "2" %} checked {% endif %} {% endif %} value="2">
                                Разрабатывает Starline
                            </label>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td rowspan="2" >
                        <div class="form-group">
                            <label>Трафареты:</label>
                            <br>
                            <label>
                                <input type="radio" name="Traf" id='Traf_N' value="1"
                                       {% if session.get('second_form')%} {% if session['second_form']['Traf'] == "1" %} checked {% endif %} {% endif %}>
                                Давальческие
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="Traf" id="Traf_Y"
                                       {% if session.get('second_form')%} {% if session['second_form']['Traf'] == "2" %} checked {% endif %} {% endif %} value="2">
                                Разрабатывает Starline
                                <div class="form-group" id="Traf_costs" style="display:none; margin: 10px">
                                    <table margin="0">
                                        <tr>
                                            <td>
                                                <div class="form-group">
                                                    <label>Количество сторон SMD:</label>
                                                    <br>
                                                    <label>
                                                        <input type="radio" name="sides_SMD" value="1"
                                                            {% if session.get('second_form')%} {% if session['second_form']['sides_SMD'] == "1" %} checked {% endif %} {% endif %}>
                                                        Односторонняя
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="radio" name="sides_SMD"
                                                            {% if session.get('second_form')%} {% if session['second_form']['sides_SMD'] == "2" %} checked {% endif %} {% endif %} value="2">
                                                        Двусторонняя
                                                    </label>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="form-group">
                                                    <label>Выбор стоимости:</label>
                                                    <br>
                                                    <label>
                                                        <input type="radio" name="Trafs_costs_select" value="1" id="Trafs_costs_select1"
                                                            {% if session.get('second_form')%} {% if session['second_form']['Trafs_costs_select'] == "1" %} checked {% endif %} {% endif %}>
                                                        Тарифная
                                                    </label>
                                                    <br>
                                                    <label>
                                                        <input type="radio" name="Trafs_costs_select" id="Trafs_costs_select2"
                                                            {% if session.get('second_form')%} {% if session['second_form']['Trafs_costs_select'] == "2" %} checked {% endif %} {% endif %} value="2">
                                                        Ручная
                                                    </label>
                                                    <div class="form-group" id="Traf_costs1" style="display:none; margin: 10px">
                                                        <label>Стоимость трафарета</label>
                                                        <br>
                                                        <select name="Traf_value2" class="form-control">
                                                            <option {% if session.get('second_form')%} {% if session['second_form']['Traf_value2'] == "1" %} selected {% endif %} {% endif %}
                                                                    value="1" >
                                                                Простой трафарет - 15.000 руб
                                                            </option>
                                                            <option {% if session.get('second_form')%} {% if session['second_form']['Traf_value2'] == "2" %} selected {% endif %} {% endif %}
                                                                    value="2">
                                                                Средний трафарет - 30.000 руб
                                                            </option>
                                                            <option {% if session.get('second_form')%} {% if session['second_form']['Traf_value2'] == "3" %} selected {% endif %} {% endif %}
                                                                    value="3">
                                                                Сложный трафарет - 100.000 руб
                                                            </option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group" id="Traf_costs2" style="display:none; margin: 10px">
                                                        <label>Стоимость трафарета</label>
                                                        <input type="number" class="form-control" name="Traf_value"
                                                            value="{{ session['second_form']['Traf_value'] if session.get('second_form') else '' }}"
                                                            placeholder="За 1 шт." min="0" step="1000">
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </label>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label>Ширина:</label>
                            <input type="number" class="form-control" min="1" step="any" name="width" 
                                value="{{ session['second_form']['width'] if session.get('second_form') else '' }}">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="form-group">
                            <label>Длина:</label>
                            <input type="number" class="form-control" min="1" step="any" name="length" 
                                value="{{ session['second_form']['length'] if session.get('second_form') else '' }}">
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="form-group">
                            <label>Производство:</label>
                            <br>
                            <label>
                                <input type="radio" name="prod" value="1"
                                       {% if session.get('second_form')%} {% if session['second_form']['prod'] == "1" %} checked {% endif %} {% endif %}>
                                Победит 1
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="prod"
                                       {% if session.get('second_form')%} {% if session['second_form']['prod'] == "2" %} checked {% endif %} {% endif %} value="2">
                                Победит 5
                            </label>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <div class="form-group">
                                <label>Количество плат по Y:</label>
                                <input type="number" class="form-control" name="width_num" id="width_num" min ="1"
                                    value="{{ session['second_form']['width_num'] if session.get('second_form') else '' }}">
                            </div>
                            <div class="form-group">
                                <label>Количество плат по X:</label>
                                <input type="number" min="1" class="form-control" name="length_num" id="length_num"
                                    value="{{ session['second_form']['length_num'] if session.get('second_form') else '' }}">
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="form-group">
                            <label>Производилось ранее?</label>
                            <br>
                            <label>
                                <input type="radio" name="prev" value="1"
                                       {% if session.get('second_form')%} {% if session['second_form']['prev'] == "1" %} checked {% endif %} {% endif %}>
                                Да
                            </label>
                            <br>
                            <label>
                                <input type="radio" name="prev"
                                       {% if session.get('second_form')%} {% if session['second_form']['prev'] == "2" %} checked {% endif %} {% endif %} value="2">
                                Нет
                            </label>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label>Всего плат:</label>
                            <input type="number" min="1" class="form-control" name="pc" id ="pc" readonly>
                        </div>
                        <div class="form-group">
                            <label>Всего мультизаготовок:</label>
                            <input type="number" min="1" class="form-control" name="multi" id ="multi" readonly>
                        </div>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <script>
        let num_x = document.getElementById('length_num');
        let num_y = document.getElementById('width_num');
        function checkOption(optionId, fieldId) {
            var radioOption1 = document.getElementById(optionId);
            var extraField = document.getElementById(fieldId);

            if(radioOption1.checked) {
                extraField.style.display = 'block';
            } else {
                extraField.style.display = 'none';
            }
        }

        window.onload = function(){
            checkOption('Traf_Y', 'Traf_costs');
            checkOption('Trafs_costs_select1', 'Traf_costs1');
            checkOption('Trafs_costs_select2', 'Traf_costs2');
            pc_number();
        }
        document.getElementById('Traf_Y').addEventListener('change', function() {
            checkOption('Traf_Y', 'Traf_costs');
        });

        document.getElementById('Traf_N').addEventListener('change', function() {
            checkOption('Traf_Y', 'Traf_costs');
        });

        document.getElementById('Trafs_costs_select1').addEventListener('change', function() {
            checkOption('Trafs_costs_select1', 'Traf_costs1');
        });

        document.getElementById('Trafs_costs_select2').addEventListener('change', function() {
            checkOption('Trafs_costs_select2', 'Traf_costs2');
        });

        document.getElementById('Trafs_costs_select2').addEventListener('change', function() {
            checkOption('Trafs_costs_select1', 'Traf_costs1');
        });

        document.getElementById('Trafs_costs_select1').addEventListener('change', function() {
            checkOption('Trafs_costs_select2', 'Traf_costs2');
        });
        
        document.getElementById('length_num').addEventListener('change', function() {
            pc_number();
        });
        
        document.getElementById('width_num').addEventListener('change', function() {
            pc_number();
        });

        function pc_number(){
            const pc_x = parseInt(num_x.value);
            const pc_y = parseInt(num_y.value);
            document.getElementById('pc').value = pc_x * pc_y;
            document.getElementById('multi').value = Math.ceil({{session['home_form']['field3']}} / (pc_x * pc_y));
        }
    </script>
</body>
</html>